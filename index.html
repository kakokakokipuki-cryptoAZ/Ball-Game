<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>30 Layers Escape</title>
    <style>
        body { background: #111; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { z-index: 5; }
        #bomb-video { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 99; mix-blend-mode: screen; }
        #msg { position: fixed; color: black; font-size: 8vw; display: none; z-index: 100; font-weight: bold; }
    </style>
</head>
<body>
    <video id="bomb-video" muted playsinline><source src="video.mp4" type="video/mp4"></video>
    <div id="msg">ÂÆå„ÄÇ</div>
    <canvas id="c"></canvas>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        const video = document.getElementById('bomb-video');
        const msg = document.getElementById('msg');
        
        let size = Math.min(window.innerWidth, window.innerHeight);
        canvas.width = canvas.height = size;
        const centerX = size / 2, centerY = size / 2;

        // --- Ë®≠ÂÆöÔºöÂ£Å„ÅÆÊï∞ ---
        let layers = [];
        for(let i = 0; i < 30; i++) {
            layers.push(size / 2 - (i * 8)); // 8„Éî„ÇØ„Çª„É´ÈñìÈöî„Åß30Êûö„ÅÆÂÜÜ
        }

        let x = centerX, y = centerY;
        let vx = 5, vy = 5;
        let ballRadius = 6;
        let escaped = false;

        function draw() {
            if (escaped) return;

            ctx.fillStyle = 'rgba(17, 17, 17, 0.3)';
            ctx.fillRect(0, 0, size, size);

            // Â£ÅÔºà„É¨„Ç§„É§„ÉºÔºâ„ÅÆÊèèÁîª
            layers.forEach((r, index) => {
                ctx.beginPath();
                ctx.arc(centerX, centerY, r, 0, Math.PI * 2);
                ctx.strokeStyle = `hsl(${index * 12}, 70%, 50%)`;
                ctx.lineWidth = 3;
                ctx.stroke();
            });

            // ÁßªÂãï
            x += vx; y += vy;

            // ‰∏ÄÁï™Â§ñÂÅ¥„ÅÆÂ£Å„Å®„ÅÆÂà§ÂÆö
            let currentRadius = layers[0];
            const dist = Math.hypot(x - centerX, y - centerY);

            if (dist + ballRadius > currentRadius) {
                // Ë∑≥„Å≠Ëøî„ÇäË®àÁÆó
                const nx = (x - centerX) / dist;
                const ny = (y - centerY) / dist;
                const dot = vx * nx + vy * ny;
                vx -= 2 * dot * nx;
                vy -= 2 * dot * ny;

                // --- „É©„É≥„ÉÄ„É†ÊÄß„ÇíËøΩÂä† ---
                vx += (Math.random() - 0.5) * 4;
                vy += (Math.random() - 0.5) * 4;

                // Â£Å„Çí1ÊûöÊ∂àÂéª
                layers.shift(); 

                // ÂÖ®„É¨„Ç§„É§„ÉºÁ™ÅÁ†¥
                if (layers.length === 0) {
                    startEscape();
                }
            }

            // „Éú„Éº„É´
            ctx.beginPath();
            ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'white';
            ctx.fill();

            requestAnimationFrame(draw);
        }

        function startEscape() {
            escaped = true;
            let rocketY = y, rocketX = x;
            const fly = setInterval(() => {
                ctx.fillStyle = '#111'; ctx.fillRect(0, 0, size, size);
                ctx.font = "50px serif"; ctx.fillText("üöÄ", rocketX, rocketY);
                rocketY -= 20;
                if (rocketY < -100) { clearInterval(fly); triggerExplosion(); }
            }, 16);
        }

        function triggerExplosion() {
            canvas.style.display = "none";
            video.style.display = "block";
            video.play().catch(() => explodeFallback());
            video.onended = () => {
                video.style.display = "none";
                document.body.style.backgroundColor = "white";
                msg.style.display = "block";
            };
        }

        function explodeFallback() {
            document.body.style.backgroundColor = "red";
            msg.innerText = "üí•BOMB!üí•"; msg.style.display = "block";
        }

        draw();
        // „ÇØ„É™„ÉÉ„ÇØ„ÅßÂãïÁîª„ÅÆÊ∫ñÂÇôÔºà„Éñ„É©„Ç¶„Ç∂Âà∂ÈôêÂØæÁ≠ñÔºâ
        window.addEventListener('mousedown', () => video.load());
    </script>
</body>
</html>
